
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Movies Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  </head>
  <body class="bg-light">
    <div class="container py-4">
      <h1 class="mb-4">Metacritic Movies Dashboard</h1>

      <div class="mb-3">
        <a class="btn btn-primary" href="{{ url_for('create') }}">Thêm</a>
        <a class="btn btn-secondary" href="{{ url_for('sync_hdfs') }}">Đẩy lên HDFS</a>
      </div>

      {% with messages = get_flashed_messages() %}
        {% if messages %}
          <div class="alert alert-info">{% for m in messages %}{{ m }}<br>{% endfor %}</div>
        {% endif %}
      {% endwith %}
      <form method="get" class="mb-3" class="d-flex">
        <input type="text" name="search" value="{{ search }}" class="form-control me-2" placeholder="Search movie by name">
        <button class="btn btn-primary" type="submit">Tìm kiếm</button>
      </form>
      <table class="table table-striped table-bordered bg-white">
        <thead>
          <tr>
            <th>#</th>
            <th>Movie_Name</th>
            <th>Release_Year</th>
            <th>Metascore</th>
            <th>Critic_Reviews</th>
            <th>User_Score</th>
            <th>User_Ratings</th>
            <th>Duration_Minutes</th>
            <th>Genre</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
        {% for r in rows %}
          <tr>
            <td>{{ (page - 1) * per_page + loop.index }}</td>
            <td>{{ r.Movie_Name }}</td>
            <td>{{ r.Release_Year }}</td>
            <td>{{ r.Metascore }}</td>
            <td>{{ r.Critic_Reviews }}</td>
            <td>{{ r.User_Score }}</td>
            <td>{{ r.User_Ratings }}</td>
            <td>{{ r.Duration_Minutes }}</td>
            <td>{{ r.Genre }}</td>
            <td>
              <a class="btn btn-sm btn-outline-primary" href="{{ url_for('edit', title=r.Movie_Name) }}">Cập nhật</a>
              <a class="btn btn-sm btn-outline-danger" href="{{ url_for('delete', title=r.Movie_Name) }}" onclick="return confirm('Delete this movie?')">Xóa</a>
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
      <nav aria-label="Page navigation example">
        <ul class="pagination">
          <li class="page-item {% if page <= 1 %}disabled{% endif %}">
            <a class="page-link" href="?search={{ search }}&page={{ page-1 }}">Previous</a>
          </li>
          {% for p in range(1, total_pages+1) %}
          <li class="page-item {% if p == page %}active{% endif %}">
          <a class="page-link" href="?search={{ search }}&page={{ p }}">{{ p }}</a>
          </li>
          {% endfor %}
          <li class="page-item {% if page >= total_pages %}disabled{% endif %}">
            <a class="page-link" href="?search={{ search }}&page={{ page+1 }}">Next</a>
          </li>
        </ul>
      </nav>
    </div>
  </body>
</html>
